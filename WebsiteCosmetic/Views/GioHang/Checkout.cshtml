@model IEnumerable<Models.Framework.OderDetail>
@{
    ViewBag.Title = "Checkout";
    Layout = "~/Views/Shared/_Layout.cshtml";
    double t = 0;
}
<header class="header-section d-none d-xl-block">
    <div class="header-wrapper">
        <div class="header-bottom header-bottom-color--golden section-fluid sticky-header sticky-color--golden">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12 d-flex align-items-center justify-content-between">
                        <!-- Start Header Logo -->
                        <div class="header-logo">
                            <div class="logo">
                                <a href="/"><img src="/Assets/Font/images/logo/logo_black.png" alt=""></a>
                            </div>
                        </div>
                        <!-- End Header Logo -->
                        <!-- Start Header Main Menu -->
                        <div class="main-menu menu-color--black menu-hover-color--green">
                            <nav>
                                <ul>
                                    <li class="has-dropdown">
                                        <a class="active main-menu-link" href="/">Trang chủ </a>
                                    </li>
                                    <li class="has-dropdown has-megaitem">
                                        <a href="/SanPham/ChitietSP"> Sản phẩm <i class="fa fa-angle-down"></i></a>
                                        <!-- Mega Menu -->
                                        <div class="mega-menu">
                                            <ul class="mega-menu-inner">
                                                <!-- Mega Menu Sub Link -->
                                                <li class="mega-menu-item">
                                                    <a href="/SanPham/Trangdiem" class="mega-menu-item-title">Trang Điểm</a>
                                                    <ul class="mega-menu-sub">
                                                        <li><a href="shop-grid-sidebar-left.html">Cushion</a></li>
                                                        <li><a href="shop-grid-sidebar-right.html">Kem nền</a></li>
                                                        <li><a href="shop-full-width.html">Phấn má hồng</a></li>
                                                        <li><a href="shop-list-sidebar-left.html">Xịt khoáng</a></li>
                                                        <li><a href="shop-list-sidebar-right.html">Son Môi</a></li>
                                                        <li><a href="shop-list-sidebar-left.html">Son dưỡng</a></li>
                                                        <li><a href="shop-list-sidebar-right.html">Phấn mắt</a></li>
                                                    </ul>
                                                </li>
                                                <!-- Mega Menu Sub Link -->
                                                <li class="mega-menu-item">
                                                    <a href="/SanPham/Chamsocda" class="mega-menu-item-title">Chăm Sóc Da</a>
                                                    <ul class="mega-menu-sub">
                                                        <li><a href="cart.html">Mask giấy</a></li>
                                                        <li><a href="empty-cart.html">Mặt nạ</a></li>
                                                        <li><a href="wishlist.html">Sữa rửa mặt</a></li>
                                                        <li><a href="compare.html">Dưỡng da mặt</a></li>
                                                        <li><a href="checkout.html">Tẩy da chết</a></li>
                                                        <li><a href="login.html">Dưỡng da mắt</a></li>
                                                        <li><a href="my-account.html">Lotion</a></li>
                                                    </ul>
                                                </li>
                                                <!-- Mega Menu Sub Link -->
                                                <li class="mega-menu-item">
                                                    <a href="/SanPham/Nuochoa" class="mega-menu-item-title">Nước Hoa</a>
                                                    <ul class="mega-menu-sub">
                                                        <li><a href="ChitietSP.html">Nước hoa nữ</a></li>
                                                        <li><a href="product-details-variable.html">Nước hoa nam</a></li>
                                                        <li><a href="product-details-affiliate.html">Xịt body</a></li>
                                                        <li><a href="product-details-group.html">Sữa tắm</a></li>
                                                        <li><a href="product-details-single-slide.html">Tẩy lông</a></li>
                                                        <li><a href="product-details-group.html">Sữa dưỡng thể</a></li>
                                                        <li><a href="product-details-single-slide.html">Kem dưỡng tay</a></li>
                                                    </ul>
                                                </li>
                                                <!-- Mega Menu Sub Link -->
                                                <li class="mega-menu-item">
                                                    <a href="/SanPham/Phukien" class="mega-menu-item-title">Phụ Kiện</a>
                                                    <ul class="mega-menu-sub">
                                                        <li><a href="product-details-tab-left.html">Dụng cụ trang điểm</a></li>
                                                        <li><a href="product-details-tab-right.html">Phụ kiện làm đẹp</a></li>
                                                        <li><a href="product-details-gallery-left.html">Sơn móng tay</a></li>
                                                        <li><a href="product-details-gallery-right.html">Rửa móng</a></li>
                                                        <li><a href="product-details-sticky-left.html">Mút đánh phấn</a></li>
                                                        <li><a href="product-details-sticky-right.html">Mặt nạ nén</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                            <div class="menu-banner">
                                                <a href="#" class="menu-banner-link">
                                                    <img class="menu-banner-img" src="/Assets/Font/images/banner/banner-blackV.jpg" alt="">
                                                </a>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="has-dropdown">
                                        <a href="/Home/Khuyenmai">Khuyến mãi</a>
                                    </li>
                                    <li class="has-dropdown">
                                        <a href="#">Tin tức<i class="fa fa-angle-down"></i></a>
                                        <!-- Sub Menu -->
                                        <ul class="sub-menu">
                                            <li><a href="/Home/About">Về chúng tôi</a></li>
                                            <li><a href="/Tintuc/Review">Review sản phẩm</a></li>
                                            <li><a href="/Tintuc/CSdoitra">Chính sách đổi trả</a></li>
                                            <li><a href="/Tintuc/Login">Đăng nhập</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="#">Thương Hiệu <i class="fa fa-angle-down"></i></a>
                                        <ul class="sub-menu">
                                            <li><a href="#">3CE</a></li>
                                            <li><a href="#">3W Clinic</a></li>
                                            <li><a href="">A'PIEU</a></li>
                                            <li><a href="">Aritaum</a></li>
                                            <li><a href="">Avene</a></li>
                                            <li><a href="">Bath and body works</a></li>
                                            <li><a href="">Benton</a></li>
                                            <li><a href="">Biodema</a></li>
                                            <li><a href="">Careline</a></li>
                                            <li><a href="">City color</a></li>
                                            <li><a href="">Covergril</a></li>
                                            <li><a href="">DHC</a></li>
                                            <li><a href="">Dr.Belmeur</a></li>
                                            <li><a href="">Etude House</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="/Home/Contact">Liên hệ</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        <!-- End Header Main Menu Start -->
                        <!-- Start Header Action Link -->
                        <ul class="header-action-link action-color--black action-hover-color--green">
                            <li>
                                <a href="#offcanvas-wishlish" class="offcanvas-toggle">
                                    <i class="icon-heart"></i>
                                    <span class="item-count">3</span>
                                </a>
                            </li>
                            <li>
                                <a href="#offcanvas-add-cart" class="offcanvas-toggle">
                                    <i class="icon-bag"></i>
                                    <span class="item-count">3</span>
                                </a>
                            </li>
                            <li>
                                <a href="#search">
                                    <i class="icon-magnifier"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#offcanvas-about" class="offacnvas offside-about offcanvas-toggle">
                                    <i class="icon-menu"></i>
                                </a>
                            </li>
                        </ul>
                        <!-- End Header Action Link -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
<!-- Start Header Area -->
<!-- Start Mobile Header -->
<div class="mobile-header mobile-header-bg-color--golden section-fluid d-lg-block d-xl-none">
    <div class="container">
        <div class="row">
            <div class="col-12 d-flex align-items-center justify-content-between">
                <!-- Start Mobile Left Side -->
                <div class="mobile-header-left">
                    <ul class="mobile-menu-logo">
                        <li>
                            <a href="/">
                                <div class="logo">
                                    <img src="/Assets/Font/images/logo/logo_black.png" alt="">
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- End Mobile Left Side -->
                <!-- Start Mobile Right Side -->
                <div class="mobile-right-side">
                    <ul class="header-action-link action-color--black action-hover-color--golden">
                        <li>
                            <a href="#search">
                                <i class="icon-magnifier"></i>
                            </a>
                        </li>
                        <li>
                            <a href="#offcanvas-wishlish" class="offcanvas-toggle">
                                <i class="icon-heart"></i>
                                <span class="item-count">3</span>
                            </a>
                        </li>
                        <li>
                            <a href="#offcanvas-add-cart" class="offcanvas-toggle">
                                <i class="icon-bag"></i>
                                <span class="item-count">3</span>
                            </a>
                        </li>
                        <li>
                            <a href="#mobile-menu-offcanvas" class="offcanvas-toggle offside-menu">
                                <i class="icon-menu"></i>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- End Mobile Right Side -->
            </div>
        </div>
    </div>
</div>
<div class="breadcrumb-section breadcrumb-bg-color--golden">
    <div class="breadcrumb-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h3 class="breadcrumb-title">Đặt hàng</h3>
                    <div class="breadcrumb-nav breadcrumb-nav-color--black breadcrumb-nav-hover-color--golden">
                        <nav aria-label="breadcrumb">
                            <ul>
                                <li><a href="/">Trang chủ</a></li>
                                <li class="active" aria-current="page">Tiến hành đặt hàng</li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- ...:::: End Breadcrumb Section:::... -->
<!-- ...:::: Start Checkout Section:::... -->
<div class="checkout-section">
    <div class="container">
        <div class="row">
            <!-- User Quick Action Form -->
            <div class="col-12">
                <div class="user-actions accordion" data-aos="fade-up" data-aos-delay="0">
                    <h3>
                        <i class="fa fa-file-o" aria-hidden="true"></i>
                        Bạn đã từng mua hàng?
                        <a class="Returning" href="#" data-bs-toggle="collapse" data-bs-target="#checkout_login" aria-expanded="true">Nhấn vào đây để đăng nhập</a>
                    </h3>
                    <div id="checkout_login" class="collapse" data-parent="#checkout_login">
                        <div class="checkout_info">
                            <p>Nếu bạn đã từng mua hàng thì hãy đăng nhập vào đây trước khi mua hàng, sau đó thì hãy điền thông tin bên dưới.</p>
                            <form action="#">
                                <div class="form_group default-form-box">
                                    <label>Username or email <span>*</span></label>
                                    <input type="text">
                                </div>
                                <div class="form_group default-form-box">
                                    <label>Password <span>*</span></label>
                                    <input type="password">
                                </div>
                                <div class="form_group group_3 default-form-box">
                                    <button class="btn btn-md btn-black-default-hover" type="submit">Login</button>
                                    <label class="checkbox-default">
                                        <input type="checkbox">
                                        <span>Remember me</span>
                                    </label>
                                </div>
                                <a href="#">Quên mật khẩu?</a>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- <div class="user-actions accordion" data-aos="fade-up"  data-aos-delay="200">
                    <h3>
                        <i class="fa fa-file-o" aria-hidden="true"></i>
                        Bạn đã từng mua hàng?
                        <a class="Returning" href="#" data-bs-toggle="collapse" data-bs-target="#checkout_coupon" aria-expanded="true">Nhấn vào đây nhận mã giảm giá</a>

                    </h3>
                    <div id="checkout_coupon" class="collapse checkout_coupon" data-parent="#checkout_coupon">
                        <div class="checkout_info">
                            <form action="#">
                                <input placeholder="Coupon code" type="text">
                                <button class="btn btn-md btn-black-default-hover" type="submit">Lấy mã</button>
                            </form>
                        </div>
                    </div>
                </div> -->
            </div>
            <!-- User Quick Action Form -->
        </div>
        <!-- Start User Details Checkout Form -->
        <div class="checkout_form" data-aos="fade-up" data-aos-delay="400">
            @using (Html.BeginForm("Checkout", "GioHang", FormMethod.Post))
            {
                <div class="row">
                    @*@Html.ActionLink( "InsertCustomer", "GioHang")*@
                    <div class="col-lg-6 col-md-6">
                        <h3>Địa chỉ nhận hàng</h3>
                        <div class="row">
                            <div class="col-12">
                                <div class="default-form-box">
                                    <label>Họ và tên <span>*</span></label>
                                    <input type="text" id="txt_hoten" name="Name">
                                    <div class="invalid-feedback" id="val-txtName" style="display:none; margin-left: 135px;">Vui lòng nhập đúng thông tin!</div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="default-form-box">
                                    <label>Số Điện Thoại<span>*</span></label>
                                    <input type="text" id="txt_dienthoai" name="Sodienthoai">
                                    <div class="invalid-feedback" id="val-txtName" style="display:none; margin-left: 135px;">Vui lòng nhập đúng thông tin!</div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="default-form-box">
                                    <label> Email  <span>*</span></label>
                                    <input type="text" id="txt_email" name="Email">
                                    <div class="invalid-feedback" id="val-txtName" style="display:none; margin-left: 135px;">Vui lòng nhập đúng thông tin!</div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="default-form-box">
                                    <label for="country">Thành Phố <span>*</span></label>
                                    <select class="country_option nice-select wide" name="country" id="country">
                                        <option value="2">Hà Nội</option>
                                        <option value="3">Hưng Yên</option>
                                        <option value="4">Đà Nẵng</option>
                                        <option value="5">Hồ Chí Minh</option>
                                        <option value="6">Hải Phòng</option>
                                        <option value="7">Huế</option>
                                        <option value="8">Thanh Hoá</option>
                                        <option value="9">Quảng Ninh</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="default-form-box">
                                    <label>Địa Chỉ <span>*</span></label>
                                    <input placeholder="Số nhà, đường, " id="txtAdress" type="text" name="Address">
                                    <div class="invalid-feedback" id="val-txtName" style="display:none; margin-left: 135px;">Vui lòng nhập đúng thông tin!</div>
                                </div>
                            </div>
                            <div class="col-12 mt-3">
                                <div class="order-notes">
                                    <label for="order_note">Ghi Chú</label>
                                    <textarea id="order_note" name="Node" placeholder="Nhận hàng buổi sáng,..."></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="order_button pt-3">
                            <button class="btn btn-md btn-black-default-hover"  type="submit">Đặt Hàng</button>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <h3>Sản phẩm</h3>
                        <div class="order_table table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Sản phẩm</th>
                                        <th>Giá</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        if (item.SpecificProduct.Offer == null)
                                        {
                                            t = t + item.Quantity * item.SpecificProduct.Price;
                                        }
                                        else
                                        {
                                            t = t + (double)(item.Quantity * (item.SpecificProduct.Price - item.SpecificProduct.Offer * item.SpecificProduct.Price));
                                        }
                                        <tr>
                                            <td> @item.SpecificProduct.Product.ProName <strong> × @item.Quantity</strong></td>
                                            @if (item.SpecificProduct.Offer != null)
                                            {
                                                <td class="product-price price">@(item.SpecificProduct.Price - item.SpecificProduct.Price * item.SpecificProduct.Offer)</td>
                                            }
                                            else
                                            {
                                                <td class="product-price price">@item.SpecificProduct.Price</td>
                                            }
                                        </tr>
                                    }
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th>Tạm tính</th>
                                        <td class="price">@t</td>
                                    </tr>
                                    <tr>
                                        <th>Phí ship</th>
                                        <td><strong>30.000đ</strong></td>
                                    </tr>
                                    <tr class="order_total">
                                        <th>Tổng tiền</th>
                                        <td><strong class="price" name="MoneyTotal">@(t + 30000)</strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="payment_method">
                            <div class="panel-default">
                                <label class="checkbox-default" for="currencyCod" data-bs-toggle="collapse" data-bs-target="#methodCod">
                                    <input type="checkbox" id="currencyCod">
                                    <span>Trả tiền khi nhận hàng</span>
                                </label>

                                <div id="methodCod" class="collapse" data-parent="#methodCod">
                                    <div class="card-body1">
                                        <p>Làm phiền bạn đưa tiền cho shipper khi nhận hàng!</p>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-default">
                                <label class="checkbox-default" for="currencyPaypal" data-bs-toggle="collapse" data-bs-target="#methodPaypal">
                                    <input type="checkbox" id="currencyPaypal">
                                    <span>Chuyển khoản</span>
                                </label>
                                <div id="methodPaypal" class="collapse " data-parent="#methodPaypal">
                                    <div class="card-body1">
                                        <p>Thanh toán qua PayPal; bạn có thể thanh toán bằng thẻ tín dụng của mình nếu bạn không có tài khoản PayPal.</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            }
        </div>

    </div>
</div>
@section Script{
    <script>
        var list = Session.list(sessionStorage.getItem('Cart'));
        function DatHang() {
            var number = /^[0-9]+$/;
            var hoten = $('#txt_hoten').val();
            if (hoten == ' ' || hoten.length < 10) {
                $('#val-txtName').css({ 'display': 'block', 'color': 'red' });

                $('#txt_hoten').click(function () {
                    $('#val-txtName').css({ 'display': 'none' });
                })
            } else {
                $('#txt_hoten').val();
            }
            var sdt = $('#txt_dienthoai').val();
            if (!sdt.match(number) || sdt == ' ' || sdt.length != 10) {
                $('#val-txtPhone').css({ 'display': 'block', 'color': 'red' });

                $('#txt_dienthoai').click(function () {
                    $('#val-txtPhone').css({ 'display': 'none' });
                })
            } else {
                $('#txt_dienthoai').val();
            }

            var diachi = $('#txtAdress').val();
            if (diachi == '' || diachi.length < 10) {
                $('#val-txtAdress').css({ 'display': 'block', 'color': 'red' });

                $('#txtAdress').click(function () {
                    $('#val-txtAdress').css({ 'display': 'none' });
                })
            } else {
                $('#txtAdress').val();
            }
            var str = `
            <section style="text-align: center;">
                <h1>HÓA ĐƠN BÁN HÀNG</h1>
                <div class="ban">(Bản thể hiện hóa đơn mỹ phẩm)</div>
                <div class="ngay">
                    <p id="date"></p>
                    <script>
                        n = new Date();
                        y = n.getFullYear();
                        m = n.getMonth() + 1;
                        d = n.getDate();
                        document.getElementById("date").innerHTML = "Ngày " + d + " tháng " + m + " năm " + y;
            </div>
            </section>

            <div class="le dam">Tên đơn vị bán hàng: Hệ thống cửa hàng HONO</div>
            <div class="le">Mã số thuế: 3269289058</div>
            <div class="le">Địa chỉ: 89 Chùa Bộc, Đống Đa, Hà Nội</div>
            <div class="le doi">Điện thoại: 0911 584 114</div>
            <div class="le doi">Số tài khoản: 762618652671614</div>
            <div class="le dam">Người mua hàng: `+ hoten + `</div>
            <div class="le">Điện thoại: `+ sdt + `</div>
            <div class="le">Địa chỉ: `+ diachi + `</div>
            <div class="le">Ghi chú: `+ ghichu + `</div>
            <table>
                <tr>
                    <th>STT</th>
                    <th>Tên sản phẩm</th>
                    <th>Số lượng</th>
                    <th>Thành tiền</th>
                </tr>
             `;
            var n = 0;
            var t = 0;
            var sl = 0;
            for (x of list) {
            t += x.price * x.quantity;
            sl += x.quantity;
            str += `
            <tr>
                <td>`+ (++n) + `</td>
                <td>`+ x.name + `</td>
                <td>`+ x.quantity + `</td>
                <td>`+ (x.price * x.quantity) + `</td>
            </tr>
            `;
            }
            str += `
            <tr>
                <td></td>
                <td class="dam">Tổng</td>
                <td class="dam">`+ sl + `</td>
                <td class="dam">`+ t + `</td>
            </tr>
        </table>
        <div class="doi dam ky">Người mua hàng</div>
        <div class="doi dam ky">Người bán hàng</div>
        <div class="doi ky1">(Ký, ghi rõ họ tên)</div>
        <div class="doi ky1">(Ký, ghi rõ họ tên)</div>
        `;
        printHtml(str);
        }
        function printHtml(data) {
            let popupWin = window.open('', '_blank', 'top=0,left=0,height=100%,width=auto');
            popupWin.document.write(`
        <html>
            <head>
            <title>Print tab</title>
            <style>
            * {
                margin: 0;
                padding: 0;
            }

            table {
                margin-top: 15px;
                width: 100%;
            }

            body {
                width: 900px;
                margin: 0 auto;
            }

            tr {
                line-height: 27px;
            }

            table,
            th,
            td {
                border: 1px solid black;
                border-collapse: collapse;
                text-align: center;
            }

            .ngay {
                font-style: italic;
                font-size: 15px;
                margin-bottom: 5px;
            }

            .ban {
                font-style: italic;
                font-size: 15px;
                margin: 3px 0px;
            }

            .dam {
                font-weight: bold;
            }

            .le {
                margin-bottom: 4px;
                font-size: 15px;
            }

            .doi {
                width: 50%;
                float: left;
            }

            .ky {
                text-align: center;
                margin-top: 20px;
            }

            .ky1 {
                font-style: italic;
                text-align: center;
                margin-top: 5px;
            }
            </style>
            </head>
            <body onload="window.print();window.close()">${data}</body>
        </html>`
            );
            popupWin.document.close();
        }
    </script>
}

